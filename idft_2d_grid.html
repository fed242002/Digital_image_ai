<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator IDFT 2D (Grid Input)</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f8f9fa; color: #333; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
        nav { text-align: center; margin-bottom: 20px; font-size: 1.2em; }
        nav a { text-decoration: none; color: #007BFF; padding: 5px 10px; border-radius: 5px; }
        nav a.active { font-weight: bold; background-color: #28a745; color: white; }
        h1, h2 { text-align: center; color: #218838; border-bottom: 2px solid #28a745; padding-bottom: 10px; margin-bottom: 20px; }
        label { font-weight: bold; font-size: 1.1em; margin-right: 10px;}
        .grid-controls { margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .grid-controls input[type="number"] { width: 60px; padding: 8px; font-size: 1em; border: 1px solid #ccc; border-radius: 4px; }
        .grid-controls button { padding: 8px 15px; font-size: 1em; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; }
        #grid-container table { border-collapse: collapse; margin: 10px 0; }
        #grid-container input { width: 80px; text-align: center; padding: 5px; font-size: 1em; border: 1px solid #ddd; }
        button#calculate-btn { display: block; width: 100%; padding: 12px; margin-top: 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 18px; }
        .steps { border: 1px solid #e0e0e0; padding: 20px; margin-top: 20px; border-radius: 4px; background-color: #fdfdfd; max-height: 400px; overflow-y: auto; }
        .result-table table { border-collapse: collapse; margin: 20px auto; }
        .result-table th, .result-table td { border: 1px solid #ddd; padding: 8px 12px; text-align: center; }
        .result-table th { background-color: #28a745; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <a href="dft_2d_grid.html">DFT 2D</a> | 
            <a href="idft_2d_grid.html" class="active">IDFT 2D</a>
        </nav>
        <h1>Kalkulator IDFT 2D: Frekuensi ke Spasial</h1>
        <div class="input-section">
            <div class="grid-controls">
                <label for="rows">Baris (M):</label><input type="number" id="rows" value="2" min="1">
                <label for="cols">Kolom (N):</label><input type="number" id="cols" value="2" min="1">
                <button onclick="generateGrid()">Buat/Ubah Grid</button>
            </div>
            <label>Masukkan nilai F(u,v) pada grid:</label>
            <div id="grid-container"></div>
            <p>Rumus: $$ f(x,y) = \frac{1}{MN} \sum_{u=0}^{M-1} \sum_{v=0}^{N-1} F(u,v) \cdot e^{i 2\pi (\frac{ux}{M} + \frac{vy}{N})} $$</p>
            <button id="calculate-btn" onclick="calculate2D_IDFT()">Hitung IDFT 2D</button>
        </div>
        <div class="output-section">
            <h2>Langkah-langkah Perhitungan:</h2>
            <div id="calculation-steps" class="steps"></div>
        </div>
        <div class="output-section">
            <h2>Hasil f(x,y) Sinyal Spasial:</h2>
            <div id="idft-results" class="result-table"></div>
        </div>
    </div>
    <script>
        function parseComplex(s) {
            s = s.toString().replace(/\s/g, '');
            if (!s.includes('i')) return { re: parseFloat(s) || 0, im: 0 };
            if (s === 'i') return { re: 0, im: 1 };
            if (s === '-i') return { re: 0, im: -1 };
            const match = s.match(/([+-]?\d*\.?\d+)?([+-]\d*\.?\d+)i$/);
            if (!match) {
                 const reverseMatch = s.match(/([+-]?\d*\.?\d+)i([+-]\d*\.?\d+)/);
                 if (reverseMatch) return {re: parseFloat(reverseMatch[2]), im: parseFloat(reverseMatch[1] || '1')};
                 return { re: 0, im: parseFloat(s.replace('i','')) || 0 };
            }
            let re = parseFloat(match[1] || 0);
            let im_str = match[2];
            if (im_str === '+' || im_str === '') im_str = '1';
            if (im_str === '-') im_str = '-1';
            return { re: re, im: parseFloat(im_str) };
        }

        function generateGrid() {
            const M = parseInt(document.getElementById('rows').value);
            const N = parseInt(document.getElementById('cols').value);
            const container = document.getElementById('grid-container');
            const sampleValues = [['9', '-1-2i'], ['-3', '-1+2i']];
            let table = '<table>';
            for (let i = 0; i < M; i++) {
                table += '<tr>';
                for (let j = 0; j < N; j++) {
                    const sampleValue = (i < 2 && j < 2) ? sampleValues[i][j] : '0';
                    table += `<td><input type="text" id="cell-${i}-${j}" value="${sampleValue}"></td>`;
                }
                table += '</tr>';
            }
            table += '</table>';
            container.innerHTML = table;
        }

        function readComplexGrid() {
            const M = parseInt(document.getElementById('rows').value);
            const N = parseInt(document.getElementById('cols').value);
            let matrix = [];
            for (let i = 0; i < M; i++) {
                let row = [];
                for (let j = 0; j < N; j++) {
                    const val = document.getElementById(`cell-${i}-${j}`).value;
                    row.push(parseComplex(val));
                }
                matrix.push(row);
            }
            return matrix;
        }

        function calculate2D_IDFT() {
            const Fuv = readComplexGrid();
            const M = Fuv.length;
            const N = Fuv[0].length;
            const MN = M * N;

            const stepsContainer = document.getElementById('calculation-steps');
            const resultsContainer = document.getElementById('idft-results');
            stepsContainer.innerHTML = 'Menghitung...';
            resultsContainer.innerHTML = '';
            
            let fullStepsHtml = '';
            let f_xy = Array(M).fill(0).map(() => Array(N));

            for (let x = 0; x < M; x++) {
                for (let y = 0; y < N; y++) {
                    let sumReal = 0, sumImag = 0;
                    for (let u = 0; u < M; u++) {
                        for (let v = 0; v < N; v++) {
                            const angle = 2 * Math.PI * ((u * x / M) + (v * y / N));
                            const cosAngle = Math.cos(angle);
                            const sinAngle = Math.sin(angle);
                            const F_uv = Fuv[u][v];

                            sumReal += F_uv.re * cosAngle - F_uv.im * sinAngle;
                            sumImag += F_uv.re * sinAngle + F_uv.im * cosAngle;
                        }
                    }
                    
                    f_xy[x][y] = { re: sumReal / MN, im: sumImag / MN };

                    fullStepsHtml += `<div class="step">
                        <h4>\\(f(${x},${y})\\)</h4>
                        <p>$$ \\sum_{u,v} = ${sumReal.toFixed(2)} + i(${sumImag.toFixed(2)}) $$</p>
                        <p>$$ f(${x},${y}) = \\frac{1}{${MN}} \\left( ${sumReal.toFixed(2)} + i(${sumImag.toFixed(2)}) \\right) \\approx ${f_xy[x][y].re.toFixed(2)} $$</p>
                    </div>`;
                }
            }
            stepsContainer.innerHTML = fullStepsHtml;

            let tableHtml = '<table><thead><tr><th>x\\y</th>';
            for (let y = 0; y < N; y++) tableHtml += `<th>${y}</th>`;
            tableHtml += '</tr></thead><tbody>';

            for (let x = 0; x < M; x++) {
                tableHtml += `<tr><th>${x}</th>`;
                for (let y = 0; y < N; y++) {
                    const val = Math.round(f_xy[x][y].re);
                    tableHtml += `<td>\\(${val}\\)</td>`;
                }
                tableHtml += '</tr>';
            }
            tableHtml += '</tbody></table>';
            resultsContainer.innerHTML = tableHtml;

            if (window.MathJax) MathJax.typesetPromise();
        }
        window.onload = generateGrid;
    </script>
</body>
</html>